<svelte:head>
  <script>
    function thumbHashToRGBA(t){let{PI:e,min:r,max:o,cos:l,round:f}=Math,a=t[0]|t[1]<<8|t[2]<<16,n=t[3]|t[4]<<8,u=(63&a)/63,h=(a>>6&63)/31.5-1,i=(a>>12&63)/31.5-1,s=(a>>18&31)/31,p=a>>23,m=(n>>3&63)/63,b=(n>>9&63)/63,g=n>>15,c=o(3,g?p?5:7:7&n),A=o(3,g?7&n:p?5:7),d=p?(15&t[5])/15:1,R=(t[5]>>4)/15,T=p?6:5,w=0,decodeChannel=(e,r,o)=>{let l=[];for(let f=0;f<r;f++)for(let a=f?0:1;a*r<e*(r-f);a++)l.push(((t[T+(w>>1)]>>((1&w++)<<2)&15)/7.5-1)*o);return l},x=decodeChannel(c,A,s),C=decodeChannel(3,3,1.25*m),H=decodeChannel(3,3,1.25*b),U=p&&decodeChannel(5,5,R),y=thumbHashToApproximateAspectRatio(t),B=f(y>1?32:32*y),D=f(y>1?32/y:32),G=new Uint8Array(B*D*4),I=[],L=[];for(let t=0,f=0;t<D;t++)for(let a=0;a<B;a++,f+=4){let n=u,s=h,m=i,b=d;for(let t=0,r=o(c,p?5:3);t<r;t++)I[t]=l(e/B*(a+.5)*t);for(let r=0,f=o(A,p?5:3);r<f;r++)L[r]=l(e/D*(t+.5)*r);for(let t=0,e=0;t<A;t++)for(let r=t?0:1,o=2*L[t];r*A<c*(A-t);r++,e++)n+=x[e]*I[r]*o;for(let t=0,e=0;t<3;t++)for(let r=t?0:1,o=2*L[t];r<3-t;r++,e++){let t=I[r]*o;s+=C[e]*t,m+=H[e]*t}if(p)for(let t=0,e=0;t<5;t++)for(let r=t?0:1,o=2*L[t];r<5-t;r++,e++)b+=U[e]*I[r]*o;let g=n-2/3*s,R=(3*n-g+m)/2,T=R-m;G[f]=o(0,255*r(1,R)),G[f+1]=o(0,255*r(1,T)),G[f+2]=o(0,255*r(1,g)),G[f+3]=o(0,255*r(1,b))}return{w:B,h:D,rgba:G}}function rgbaToDataURL(t,e,r){let o=4*t+1,l=6+e*(5+o),f=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,t>>8,255&t,0,0,e>>8,255&e,8,6,0,0,0,0,0,0,0,l>>>24,l>>16&255,l>>8&255,255&l,73,68,65,84,120,1],a=[0,498536548,997073096,651767980,1994146192,1802195444,1303535960,1342533948,-306674912,-267414716,-690576408,-882789492,-1687895376,-2032938284,-1609899400,-1111625188],n=1,u=0;for(let t=0,l=0,a=o-1;t<e;t++,a+=o-1)for(f.push(t+1<e?0:1,255&o,o>>8,255&~o,o>>8^255,0),u=(u+n)%65521;l<a;l++){let t=255&r[l];f.push(t),n=(n+t)%65521,u=(u+n)%65521}f.push(u>>8,255&u,n>>8,255&n,0,0,0,0,0,0,0,0,73,69,78,68,174,66,96,130);for(let[t,e]of[[12,29],[37,41+l]]){let r=-1;for(let o=t;o<e;o++)r^=f[o],r=r>>>4^a[15&r],r=r>>>4^a[15&r];r=~r,f[e++]=r>>>24,f[e++]=r>>16&255,f[e++]=r>>8&255,f[e++]=255&r}return"data:image/png;base64,"+btoa(String.fromCharCode(...f))}

    function thumbHashToDataURL(hash) {
      let image = thumbHashToRGBA(hash)
      return rgbaToDataURL(image.w, image.h, image.rgba)
    }
  </script>
</svelte:head>